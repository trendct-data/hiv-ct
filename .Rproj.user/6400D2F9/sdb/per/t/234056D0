{
    "collab_server" : "",
    "contents" : "library(readxl)\nlibrary(corrplot)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(rgeos)\nlibrary(maptools)\nlibrary(ggplot2)   # devtools::install_github(\"hadley/ggplot2\") only if you want subtitles/captions\nlibrary(ggalt)\nlibrary(ggthemes)\nlibrary(albersusa) # devtools::install_github(\"hrbrmstr/albersusa\")\nlibrary(viridis)\nlibrary(scales)\n\ny2013 <- read_excel(\"AIDSVu_County_Prev_2013.xlsx\", sheet=1, skip=2)\ny2014 <- read_excel(\"AIDSVu_County_NewDX_2014.xlsx\", sheet=1, skip=2)\n\ncolnames(y2013) <- make.names(colnames(y2013))\ncolnames(y2014) <- make.names(colnames(y2014))\n\ny2013$GEO.ID <-  ifelse(nchar(y2013$GEO.ID) == 4, paste0(\"0\", y2013$GEO.ID), y2013$GEO.ID)\ny2014$GEO.ID <-  ifelse(nchar(y2014$GEO.ID) == 4, paste0(\"0\", y2014$GEO.ID), y2014$GEO.ID)\n\n\n\nwith(y2013, cor(Gini.Coefficient, County.Rate, use=\"complete.obs\"))\n\ny2013nums <- y2013\ny2013nums$State.Abbreviation <- NULL\ny2013nums$State <- NULL\ny2013nums$County.Name <- NULL\ny2013nums$County.Rate.Stability <- NULL\ny2013nums$Male.Rate.Stability <- NULL\ny2013nums$Female.Rate.Stability <- NULL\ny2013nums$Black.Rate.Stability <- NULL\ny2013nums$Male.Rate.Stability <- NULL\ny2013nums$White.Rate.Stability <- NULL\ny2013nums$Hispanic.Rate.Stability <- NULL\ny2013nums$Age.13.24.Rate.Stability <- NULL\ny2013nums$Age.25.34.Rate.Stability <- NULL\ny2013nums$Age.35.44.Rate.Stability <- NULL\ny2013nums$Age.45.54.Rate.Stability <- NULL\ny2013nums$Age.55..Rate.Stability <- NULL\n\ny2013nums <- cor(y2013nums, use=\"na.or.complete\")\ncorrplot(y2013nums, method=\"number\")\n\n# Alright, no significant correlations between cases and uninsured, income, gini coefficient, poverty, high school, and correctional warnings\n\n# State Rate?\n\nstate_sum <- y2013 %>% \n  group_by(State) %>%\n  summarise(Rate=mean(County.Rate))\ncolnames(state_sum) <- c(\"County\", \"Overall.Rate\")\n\n\nstate_black <- y2013 %>% \n  group_by(State) %>%\n  summarise(Rate=mean(Black.Rate))\ncolnames(state_black) <- c(\"County\", \"Black.Rate\")\n\nstate_hispanic <- y2013 %>% \n  group_by(State) %>%\n  summarise(Rate=mean(Hispanic.Rate))\ncolnames(state_hispanic) <- c(\"County\", \"Hispanic.Rate\")\n\nstate_white <- y2013 %>% \n  group_by(State) %>%\n  summarise(Rate=mean(White.Rate))\ncolnames(state_white) <- c(\"County\", \"White.Rate\")\n\nstate_all <- left_join(state_sum, state_black)\nstate_all <- left_join(state_all, state_hispanic)\nstate_all <- left_join(state_all, state_white)\n\n# new origin dataframe\ny2013b <- y2013\n\n# Structure of story\n\n# Viz 1: Overall US county map 2013 (multi-tabs)\n# * County.Rate\n# * Male.Rate\n# * Female.Rate\n# * Black.Rate\n# * White.Rate\n# * Hispanic.Rate\n\n# Bringing map in\ncmap <- fortify(counties_composite(), region=\"fips\")\n\n\n# Turning into factor and creating breaks\ny2013 <- subset(y2013b, County.Rate>1)\n\ny2013$breaks <- \"NA\"\ny2013$breaks <- ifelse(y2013$County.Rate < 41, \"0-40\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 41 & y2013$County.Rate <= 60, \"41-60\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 61 & y2013$County.Rate <= 70, \"61-70\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 71 & y2013$County.Rate <= 90, \"71-90\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 91 & y2013$County.Rate <= 110, \"91-110\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 111 & y2013$County.Rate <= 140, \"111-140\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 141 & y2013$County.Rate <= 190, \"141-190\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 191 & y2013$County.Rate <= 260, \"191-260\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 261 & y2013$County.Rate <= 410, \"260-410\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Rate >= 411, \"411+\", y2013$breaks)\n\ny2013$breaks <- factor(y2013$breaks, levels=c(\"0-40\", \"41-60\", \"61-70\", \"71-90\", \"91-110\", \"111-140\", \"141-190\", \"191-260\", \"260-410\",\"411+\"))\n#y2013$breaks <- cut(y2013$County.Rate, 5)\n\ngg <- ggplot()\ngg <- gg + geom_map(data=cmap, map=cmap,\n                    aes(x=long, y=lat, map_id=id),\n                    color=\"#2b2b2b\", size=0.05, fill=NA)\ngg <- gg + geom_map(data=y2013, map=cmap,\n                    aes(fill=breaks, map_id=GEO.ID),\n                    color=\"#2b2b2b\", size=0.05, na.rm=TRUE)\n#gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\ngg <- gg + scale_fill_manual(values = c('#f7fcf0','#e0f3db','#ccebc5','#a8ddb5','#7bccc4','#4eb3d3','#2b8cbe','#0868ac','#084081', \"#081d58\"), name=\"Rate\")\n#gg <- gg + scale_fill_brewer(palette=\"PuRd\")\n#gg <- gg + scale_fill_brewer(palette = \"Reds\")\ngg <- gg + coord_proj(us_laea_proj)\ngg <- gg + theme_map(base_family=\"Arial Narrow\")\ngg <- gg + theme(legend.position=c(0.8, 0.25))\ngg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\ngg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\ngg\n\nggsave(\"rate.png\", width = 8, height = 6)\n\n\n\ny2013 <- subset(y2013b, County.Cases>=1)\n\ny2013$breaks <- \"NA\"\ny2013$breaks <- ifelse(y2013$County.Cases >= 5 & y2013$County.Cases <=8 , \"5-8\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 9 & y2013$County.Cases <= 12, \"9-12\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 13 & y2013$County.Cases <= 18, \"13-18\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 19 & y2013$County.Cases <= 24, \"19-24\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 25 & y2013$County.Cases <= 36, \"25-36\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 37 & y2013$County.Cases <= 56, \"37-56\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 57 & y2013$County.Cases <= 96, \"57-96\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 97 & y2013$County.Cases <= 166, \"97-166\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 167 & y2013$County.Cases <= 518, \"167-518\", y2013$breaks)\ny2013$breaks <- ifelse(y2013$County.Cases >= 519, \"519+\", y2013$breaks)\n\ny2013$breaks <- factor(y2013$breaks, levels = c(\"5-8\", \"9-12\", \"13-18\", \"19-24\", \"25-36\", \"37-56\", \"57-96\", \"97-166\", \"167-518\",\"519+\"))\n\ngg <- ggplot()\ngg <- gg + geom_map(data=cmap, map=cmap,\n                    aes(x=long, y=lat, map_id=id),\n                    color=\"#2b2b2b\", size=0.05, fill=NA)\ngg <- gg + geom_map(data=y2013, map=cmap,\n                    aes(fill=breaks, map_id=GEO.ID),\n                    color=\"#2b2b2b\", size=0.05)\n#gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\ngg <- gg + scale_fill_manual(values = c('#f7fcf0','#e0f3db','#ccebc5','#a8ddb5','#7bccc4','#4eb3d3','#2b8cbe','#0868ac','#084081', \"#081d58\"), name=\"Cases\")\ngg <- gg + coord_proj(us_laea_proj)\ngg <- gg + theme_map(base_family=\"Arial Narrow\")\ngg <- gg + theme(legend.position=c(0.8, 0.25))\ngg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\ngg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\ngg\n\nggsave(\"total.png\", width = 8, height = 6)\n\n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=y2013, map=cmap,\n#                     aes(fill=Male.Rate, map_id=GEO.ID),\n#                     color=\"#2b2b2b\", size=0.05)\n# #gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + scale_fill_gradient(low=\"beige\", high=\"red\", name=\"Rate\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# ggsave(\"male_rate.png\", scale=.5)\n# \n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=y2013, map=cmap,\n#                     aes(fill=Female.Rate, map_id=GEO.ID),\n#                     color=\"#2b2b2b\", size=0.05)\n# #gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + scale_fill_gradient(low=\"beige\", high=\"red\", name=\"Rate\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# ggsave(\"female_rate.png\", scale=.5)\n# \n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=y2013, map=cmap,\n#                     aes(fill=Black.Rate, map_id=GEO.ID),\n#                     color=\"#2b2b2b\", size=0.05)\n# #gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + scale_fill_gradient(low=\"beige\", high=\"red\", name=\"Rate\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# ggsave(\"black_rate.png\", scale=.5)\n# \n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=y2013, map=cmap,\n#                     aes(fill=Hispanic.Rate, map_id=GEO.ID),\n#                     color=\"#2b2b2b\", size=0.05)\n# #gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + scale_fill_gradient(low=\"beige\", high=\"red\", name=\"Rate\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# ggsave(\"hispanic_rate.png\", scale=.5)\n# \n# \n# \n# gg <- ggplot()\n# gg <- gg + geom_map(data=cmap, map=cmap,\n#                     aes(x=long, y=lat, map_id=id),\n#                     color=\"#2b2b2b\", size=0.05, fill=NA)\n# gg <- gg + geom_map(data=y2013, map=cmap,\n#                     aes(fill=White.Rate, map_id=GEO.ID),\n#                     color=\"#2b2b2b\", size=0.05)\n# #gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\n# gg <- gg + scale_fill_gradient(low=\"beige\", high=\"red\", name=\"Rate\")\n# gg <- gg + coord_proj(us_laea_proj)\n# gg <- gg + theme_map(base_family=\"Arial Narrow\")\n# gg <- gg + theme(legend.position=c(0.8, 0.25))\n# gg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\n# gg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\n# gg\n# \n# ggsave(\"white_rate.png\", scale=.5)\n\n\n# Viz 2: New Diagnosis 2014\n# * Rate\n# * Cases\ny2014b <- y2014\n\ny2014 <- subset(y2014b, New.Diagnoses.Rate>1)\n\ny2014$breaks <- \"NA\"\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate < 6, \"0-6\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 7 & y2014$New.Diagnoses.Rate <= 8, \"7-8\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 9 & y2014$New.Diagnoses.Rate <= 9, \"9-9\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 10 & y2014$New.Diagnoses.Rate <= 11, \"10-11\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 12 & y2014$New.Diagnoses.Rate <= 14, \"12-14\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 15 & y2014$New.Diagnoses.Rate <= 17, \"15-17\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 18 & y2014$New.Diagnoses.Rate <= 21, \"18-21\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 22 & y2014$New.Diagnoses.Rate <= 28, \"22-28\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 29 & y2014$New.Diagnoses.Rate <= 40, \"29-40\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Rate >= 41, \"41+\", y2014$breaks)\n\ny2014$breaks <- factor(y2014$breaks, levels=c(\"0-6\", \"7-8\", \"9-9\", \"10-11\", \"12-14\", \"15-17\", \"18-21\", \"22-28\", \"29-40\",\"41+\"))\n\n\n\ngg <- ggplot()\ngg <- gg + geom_map(data=cmap, map=cmap,\n                    aes(x=long, y=lat, map_id=id),\n                    color=\"#2b2b2b\", size=0.05, fill=NA)\ngg <- gg + geom_map(data=y2014, map=cmap,\n                    aes(fill=breaks, map_id=GEO.ID),\n                    color=\"#2b2b2b\", size=0.05)\n#gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\ngg <- gg + scale_fill_manual(values = c('#fff7ec','#fee8c8','#fdd49e','#fdbb84','#fc8d59','#ef6548','#d7301f','#b30000','#7f0000', '#67000d'), name=\"Rate\")\ngg <- gg + coord_proj(us_laea_proj)\ngg <- gg + theme_map(base_family=\"Arial Narrow\")\ngg <- gg + theme(legend.position=c(0.8, 0.25))\ngg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\ngg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\ngg\n\nggsave(\"2014_rate.png\", width = 8, height = 6)\n\n\ny2014 <- subset(y2014b, New.Diagnoses.Cases>1)\n\ny2014$breaks <- \"NA\"\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases == 5, \"5\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases == 6, \"6\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 7 & y2014$New.Diagnoses.Cases <= 8, \"7-8\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 9 & y2014$New.Diagnoses.Cases <= 10, \"9-10\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 11 & y2014$New.Diagnoses.Cases <= 13, \"11-13\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 14 & y2014$New.Diagnoses.Cases <= 19, \"14-19\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 20 & y2014$New.Diagnoses.Cases <= 28, \"20-28\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 29 & y2014$New.Diagnoses.Cases <= 49, \"29-49\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 50 & y2014$New.Diagnoses.Cases <= 111, \"50-111\", y2014$breaks)\ny2014$breaks <- ifelse(y2014$New.Diagnoses.Cases >= 112, \"112+\", y2014$breaks)\n\ny2014$breaks <- factor(y2014$breaks, levels=c(\"5\", \"6\", \"7-8\", \"9-10\", \"11-13\", \"14-19\", \"20-28\", \"29-49\", \"50-111\",\"112+\"))\n\n\n\n\ngg <- ggplot()\ngg <- gg + geom_map(data=cmap, map=cmap,\n                    aes(x=long, y=lat, map_id=id),\n                    color=\"#2b2b2b\", size=0.05, fill=NA)\ngg <- gg + geom_map(data=y2014, map=cmap,\n                    aes(fill=breaks, map_id=GEO.ID),\n                    color=\"#2b2b2b\", size=0.05)\n#gg <- gg + scale_fill_viridis(name=\"Uninsured\",labels=percent)\ngg <- gg + scale_fill_manual(values = c('#fff7ec','#fee8c8','#fdd49e','#fdbb84','#fc8d59','#ef6548','#d7301f','#b30000','#7f0000', '#67000d'), name=\"Cases\")\ngg <- gg + coord_proj(us_laea_proj)\ngg <- gg + theme_map(base_family=\"Arial Narrow\")\ngg <- gg + theme(legend.position=c(0.8, 0.25))\ngg <- gg + theme(plot.title=element_text(face=\"bold\", size=14, margin=margin(b=6)))\ngg <- gg + theme(plot.subtitle=element_text(size=10, margin=margin(b=-14)))\ngg\n\nggsave(\"2014_cases.png\", width = 8, height = 6)\n\n# Viz 3: Interactive CT chart (or table) counties\n# * County.Rate\n# * Black.Rate\n# * White.Rate\n# * Hispanic.Rate\n\nct_2013 <- subset(y2013, State.Abbreviation==\"CT\")\n\nct_2013 <- ct_2013 %>%\n  select(County.Name, County.Rate, Black.Rate, White.Rate, Hispanic.Rate)\n\nct_2013$County.Name <- gsub(\" County\", \"\", ct_2013$County.Name)\nwrite.csv(ct_2013, \"ct_2013.csv\")\n\n# Viz 4: Interactive CT (or table)  chart counties\n# * New.Diagnoses.Rate\n# * New.Diagnoses.Cases\n\n\n\n\nct_2014 <- subset(y2014, State.Abbreviation==\"CT\")\n\nct_2014 <- ct_2014 %>%\n  select(County.Name, New.Diagnoses.Rate, New.Diagnoses.Cases)\n\nct_2014$County.Name <- gsub(\" County\", \"\", ct_2014$County.Name)\nwrite.csv(ct_2014, \"ct_2014.csv\")\n\n\n# Viz 5: Something about Hartford?\n",
    "created" : 1467038513458.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "386513600",
    "id" : "234056D0",
    "lastKnownWriteTime" : 1467140410,
    "last_content_update" : 1467140410154,
    "path" : "~/Documents/Github/data/2016/06/hiv_ct/analysis.R",
    "project_path" : "analysis.R",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}